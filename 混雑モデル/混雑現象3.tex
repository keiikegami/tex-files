\documentclass{jsarticle}
\usepackage[margin = .7in]{geometry}
\usepackage[dvipdfmx]{graphicx}
\usepackage{listings}
\usepackage{amsmath}
\usepackage{amsfonts}
\usepackage{bm}
\usepackage{ascmac}
\lstset{%
  language={python},
  basicstyle={\small},%
  identifierstyle={\small},%
  commentstyle={\small\itshape},%
  keywordstyle={\small\bfseries},%
  ndkeywordstyle={\small},%
  stringstyle={\small\ttfamily},
  frame={tb},
  breaklines=true,
  columns=[l]{fullflexible},%
  numbers=left,%
  xrightmargin=0zw,%
  xleftmargin=3zw,%
  numberstyle={\scriptsize},%
  stepnumber=1,
  numbersep=1zw,%
  lineskip=-0.5ex%
}

\begin{document}
\title{卒論テーマ候補 ：混雑現象の構造推定}
\author{池上　慧}
\maketitle

\section{目的}
Viauroux (2007)や柳沼・福田(2007,8)、松村他などが交通手段の選択と通勤に利用する電車の出発時間選択においてプレイヤー同士の影響を考慮したゲームのモデルを用いたパラメータの推定を行っている。またその結果においては混雑による不効用を示すパラメータは有意に負の値を取っている。主に用いられていた推定手法はAgurregabiria (2004)のPMLであり、Kasahara and Shimotsu(2012?)にのっとって推定結果が収束するようにしている。

上記の研究ではプレイヤーについての情報が得られている時にプレイヤーごとに選択確率を計算することでベイジアンナッシュ均衡を計算し、推定に用いている。しかし、松村他で用いられたデータはサンプルサイズが小さく、センサスデータであり、また個人の通勤時間などについては別種の統計データから推計したものを利用している。ここではこのような意思決定を行う個人に関するデータを必要とせずに混雑現象を推定できるかを考える。

例えば、松村他で扱われた満員電車に選択モデルを考えると、個人ごとにどのような人がいつどの電車に乗ったかというデータを得るのは非現実的である。そのようなデータの代わりに何時の電車に何人が乗ったという現実的に容易に得られるデータを用いて推定できるモデルを作ることは有用であると考える。

\section{モデル}
ラッシュ時の乗車選択行動をモデル化する。全部で$M$個の駅について$T$日分のラッシュアワーに該当する電車の乗車割合に関するデータが得られており、ある駅$m$の$t$日について考える。

各駅で毎日繰り返される乗車選択ゲームを以下のように定式化する。プレイヤーは無限人とし、その乗車選択割合だけが混雑を引きおこすとする。$m$駅のラッシュアワー時の電車総数を$C_m$として、プレイヤーは乗車する電車$c$を$\left\{ 1, \cdots, C_m\right\}$から選ぶ。ただし、これらの中から同時に選択するのではなく、各$c$について乗車するかしないかの選択をする最適停止問題のようなゲームをプレイするとする。この際、毎回の選択時に今までどれだけの割合の人が乗車しているかという状態についてはわからない状況を想定し、そのようなこのゲームにおける逐次均衡が実現しているとする。

電車$c$に対するbehavioral strategyを$b_c = (\tilde{b_c}, 1 - \tilde{b_c})$で表記する。ここで$\tilde{b_c}$は電車$c$に乗車することに割り振る確率であり、$1 - \tilde{b_c}$は電車$c$には乗らずに次以降の電車のどれかに乗ることに割り振る確率である。belief systemを$\left\{ \mu_c \right\}_{c = 1}^{C_m}$で表記する。ここで$\mu_c$は電車$c$への乗車を選択する際の社会状態への信念、つまりまだ乗車していない人の割合の確率分布である。逐次均衡においてbelief systemはbehavioral strategyと矛盾しないものでないといけないため、$\mu_c = \Pi_{c^{'} = 1}^{c-1} (1 - \tilde{b_{c^{'}}})$としてbehavioral strategyが定まれば一意に定まる。

$t$日の電車$c$についての効用$(u_c^t)$はについて以下のように定式化する。選好を決定する要素は大きく3つ存在する。1つ目の要素はその電車についての特徴ベクトル$(Z_c)$である。すなわち発車時刻や電車の種類などは乗車の意思決定に大きく作用していることは間違いない。2つ目の要素はその電車の乗車割合$\mu_c \tilde{b_c}$である。混雑は乗車中の不快感や遅延の原因となるため、プレイヤーは混む電車を避けようと行動する。すなわち今選択する対象となっている電車の乗車割合はその電車にひもづく効用を減少させる要因として無視できないものである。3つ目の要素はまだ乗車していない人の割合$\mu_c$である。すなわち不確実な社会状態に効用が依存する。まだ乗車していない人の割合は以降の電車選択において期待できる混雑を予想する際に重要な要因となるため効用に作用する。以上よりそれぞれのパラメータを$(\beta_m, \gamma_m, \delta_m)$として以下のように定式化する。

\begin{align*}
	\begin{cases}
	u_c = Z_c^{'} \beta_m + \gamma_m \mu_{c} \tilde{b_c} + \delta_m \mu_c\quad \text{when $c \neq C_m$}\\[8pt]
	u_{c} = Z_c^{'} \beta_m + \gamma_m \mu_{c} + \delta_m \mu_c\quad \text{when $c = C_m$}
	\end{cases}
\end{align*}

$C_m$への乗車を決定する回まで残ったプレイヤーは必然的に$C_m$を選ばなくてはならないので$c = C_m$か否かで場合分けする必要があることに注意する。

次に各回のbehavioral strategyを二項選択で定式化する。電車$c$に関する乗車選択の際にプレイヤーが直面するvalue functionは以下のように書ける。
\begin{align*}
	\begin{cases}
	v_{c, 1} &= u_c + \epsilon_{c, 1}\\[8pt]
	v_{c, 2} &= \tilde{b_{c+1}} u_{c+1} + (1 - \tilde{b_{c+1}}) \tilde{b_{c+2}} u_{c+2} + \cdots + \Pi_{c^{'} = c+1}^{C_m-1}(1 - \tilde{b_{c^{'}}}) u_{Cm} + \epsilon_{c, 2}\\[8pt]
	&= \tilde{b_{c+1}} u_{c+1} + \sum_{c^{'}=c+1}^{C_m-1} \left( \Pi_{c^{''} = c+1}^{c^{'}} (1 - \tilde{b_{c^{''}}}) \right) \tilde{b_{c^{'} + 1}} u_{c^{'} + 1} + \epsilon_{c, 2}
	\end{cases}
\end{align*}
ここで、$\epsilon_{c, 1}, \epsilon_{c, 2}$はそれぞれ独立に第1種極値分布に従う確率変数であり、各電車の選択段階になった時に観測できるものであるとする。$v_{c, 1}$は電車$c$への乗車を決定することの価値であり、$v_{c, 2}$はここでは乗車を見送ることの価値である。$v_{c, 2}$は以降の乗車選択でも均衡のbehavioral strategyに従った時の期待利得と誤差項から構成されており、ここでの期待利得の計算に際しては以降の意思決定時に明らかになる$\left\{ \epsilon_{c^{'}} \right\}_{c^{'} = c+1}^{C_m-1}$については考慮に入れず、確定している$\left\{ u_{c^{'}} \right\}_{c^{'} = c+1}^{C_m-1}$に関しての期待値を計算していることに注意する。

$t$日の乗車選択には研究者には観測不可能な要素だがプレイヤーにとっては観測可能である要素が関わっている可能性を考慮する。例えば天気や遅延情報などの情報は各日ごとに変化し、確実にプレイヤーの行動を変化させているが、これらについての情報は研究者には得られない。この時これらの日に依存する研究者には観測不可能な変数が、選択肢である電車ではなく電車ごとの効用の差分について存在すると仮定する。この仮定は各電車の絶対的な効用水準ではなく効用の差がプレイヤーの意思決定を左右している今の状況では擁護できるものである。最後の電車である$C_m$とそれ以外の電車$c$との間に存在する研究者には観測不可能だがプレイヤーにとっては観測できる要因によってもたらされる誤差を$\xi_c^t$で表記する。$\xi$は$C_m-1$個の確率変数を集めた確率ベクトルで、平均0、分散共分散行列は$\Sigma$とする。また、この誤差項は$\epsilon$とは異なり、毎日のゲーム開始時に観測されており、behavioral startegyを決定する際にも期待値計算に使われるとする。すなわち以下のように誤差が存在する。
\begin{align*}
	(u_{C_m} - u_c)^t = (Z_{C_m} - Z_c)^{'} \beta + \gamma (\mu_{C_m} - \mu_{c} \tilde{b_c^t}) + \delta_m (\mu_{C_m} - \mu_c) + \xi_c^t
\end{align*}

これより電車$c$の乗車選択においては$\left\{ \xi_{c^{'}} \right\}_{c^{'} = c}^{C_m-1}$に依存した誤差項が存在する。通常の二項選択の議論より$t$日の電車$c$に関するbehavioral strategyは以下のように書ける。

\begin{align*}
	\tilde{b_c^t} &= \frac{1}{1 + \exp \left(\tilde{b_{c+1}^t} u_{c+1} + \sum_{c^{'}=c+1}^{C_m-1} \left( \Pi_{c^{''} = c+1}^{c^{'}} (1 - \tilde{b_{c^{''}}^t}) \right) \tilde{b_{c^{'} + 1}^t} u_{c^{'} + 1} - u_c \right)}
\end{align*}

ここで単純な計算により以下を得る。
\begin{align*}
	&\qquad \tilde{b_{c+1}^t} u_{c+1} + \sum_{c^{'}=c+1}^{C_m-1} \left( \Pi_{c^{''} = c+1}^{c^{'}} (1 - \tilde{b_{c^{''}}^t}) \right) \tilde{b_{c^{'} + 1}^t} u_{c^{'} + 1} - u_c\\[8pt]
	&= (u_{C_m} - u_c)^t - \sum_{c^{'} = c+1}^{C_m - 1} \left( \Pi_{c^{''} = c+1}^{c^{'}} (1 - \tilde{b_{c^{''} - 1}^t}) \right) \tilde{b_{c^{'}}^t} (u_{C_m} - u_{c^{'}})^t\\[8pt]
\end{align*}

これより、選択確率の式を変形することで以下の式を得る。
\begin{align}
	{\rm log}\ \frac{1 - \tilde{{b_c^t}}}{\tilde{b_c^t}} = (u_{C_m} - u_c)^t - \sum_{c^{'} = c+1}^{C_m - 1} \left( \Pi_{c^{''} = c+1}^{c^{'}} (1 - \tilde{b_{c^{''} - 1}^t}) \right) \tilde{b_{c^{'}}^t} (u_{C_m} - u_{c^{'}})^t
\end{align}

ここで以下のように表記する。
\begin{align*}
	\begin{cases}
		\tilde{Z_c^t} = (Z_{C_m} - Z_c) - \sum_{c^{'} = c+1}^{C_m - 1} \left( \Pi_{c^{''} = c+1}^{c^{'}} (1 - \tilde{b_{c^{''} - 1}^t}) \right) \tilde{b_{c^{'}}^t} (Z_{C_m} - Z_{c^{'}})\\[8pt]
		x_c^t = (\mu_{C_m} - \mu_c) - \sum_{c^{'} = c+1}^{C_m - 1} \left( \Pi_{c^{''} = c+1}^{c^{'}} (1 - \tilde{b_{c^{''} - 1}^t}) \right) \tilde{b_{c^{'}}^t} (\mu_{C_m} - \mu_{c^{'}})\\[8pt]
		y_c^t = (\mu_{C_m} - \mu_c \tilde{b_c^t}) - \sum_{c^{'} = c+1}^{C_m - 1} \left( \Pi_{c^{''} = c+1}^{c^{'}} (1 - \tilde{b_{c^{''} - 1}^t}) \right) \tilde{b_{c^{'}}^t} (\mu_{C_m} - \mu_{c^{'}} \tilde{b_{c^{'}}^t})\\[8pt]
		B_c^t = \left( -\tilde{b_{c+1}^t}\ \Pi_{c^{''} = c+1}^{c+1}(1 - \tilde{b_{c^{''} -1}^t})\ \cdots\ -\tilde{b_{C_m-1}^t}\ \Pi_{c^{''} = c+1}^{C_m-1}(1 - \tilde{b_{c^{''} -1}^t})\right)^{'}\\[8pt]
		{\xi_c^t}^{*} = \left( \xi_{c+1}^t\ \cdots\ \xi_{C_m-1}^t \right)^{'}
	\end{cases}
\end{align*}

これを用いて効用関数の定式化より（1）はパラメータを用いて以下のように表すことができる。
\begin{align}
	{\rm log}\ \frac{1 - \tilde{{b_c^t}}}{\tilde{b_c^t}} = \tilde{Z_c^t}^{'} \beta + \gamma_m y_c^t + \delta_m x_c^t + {B_c^t}^{'} \xi_c^{*} + \xi_c
\end{align}

さらに状態への信念である$\left\{ \mu_c \right\}_{c = 1}^{C_m}$と、各電車への乗車割合である$w_c^t = \mu_c^t \tilde{b_c^t}$を用いてこの式を変形する。

\begin{align*}
	\begin{cases}
	&\hat{w_c^t} = \left( \mu_c^t\  -w_{c+1}^t\  \cdots\  -w_{C_m-1}^t\right)^{'}\\[8pt]
	&\tilde{w_c^t} =  \left( -w_{c+1}^t\  \cdots\  -w_{C_m-1}^t\right)^{'}\\[8pt]
	&\bar{Z_c} = \left(Z_{C_m} - Z_c\ Z_{C_m} - Z_{c+1}\ \cdots\ Z_{C_m} - Z_{C_m - 1}\right)\\[8pt]
	&\bar{\mu_c^t} = \left( \mu_{C_m}^t - \mu_c^t\ \cdots\ \mu_{C_m} - \mu_{C_m-1} \right)^{'}\\[8pt]
	&\bar{\nu_c^t} = \left( \mu_{C_m}^t - w_c^t\ \cdots\ \mu_{C_m} - w_{C_m-1} \right)^{'}\\[8pt]
	\end{cases}
\end{align*}
とおく。$d_c^t = {\rm log}\ \frac{1 - \tilde{{b_c^t}}}{\tilde{b_c^t}}$とすると、先の式は以下のように書ける。
\begin{align*}
	d_c^t = \left( \bar{Z_c}^{'}\beta_m + \gamma_m \bar{\nu_c^t} + \delta_m \bar{\mu_c^t} \right)^{'} \left( \frac{\hat{w_c^t}}{\mu_c^t} \right) + {{\xi_c^t}^{*}}^{'} \left( \frac{\tilde{w_c^t}}{\mu_c^t} \right) + \xi_c^t
\end{align*}
ここで、${\xi_{C_m-1}^t}^{*} = 0$であることと、$\left( \frac{\hat{w_{C_m-1}^t}}{\mu_{C_m-1}^t} \right) = 1$であることを利用して、後ろから順に$\xi_c^t$を代入していくことで式を一つにまとめることができる。新しく以下の記号を定義する。
\begin{align*}
\begin{cases}
	&g_c^t = d_c^t - \left( g_{c+1}^t\ \cdots\ g_{C_m-1}^t\right) \left( \frac{\tilde{w_c^t}}{\mu_c^t} \right)\ \text{where $c \neq C_m -1$}\\[8pt]
	&g_{Cm-1}^t = d_{C_m-1}^t
\end{cases}
\end{align*}
これを用いて、先に述べた逐次代入より以下の1本の式を得る。2本目の等式は1本目の選択に際してはまだ誰も電車に乗っていないので$\mu_1^t = 1$となることによる。
\begin{align*}
	g_1^t &= (Z_{C_m} - Z_1)^{'} \beta + (\mu_{C_m}^t - \mu_1^t)\gamma_m + (\mu_{C_m}^t - w_1^t)\delta_m + \xi_1^t\\[8pt]
	&= (Z_{C_m} - Z_1)^{'} \beta + \left(\mu_{C_m}^t-1\right)\gamma_m + (\mu_{C_m}^t - w_1^t)\delta_m + \xi_1^t
\end{align*}

以上より各駅の日毎に方程式を得たので、これをまとめてパネルデータの形で表記する。まず先の式のノーテーションを駅に依存する形で表記する。
\begin{align*}
	g_m^t = (Z_{C_m} - Z_m)^{'} \beta + \left(\mu_{C_m}^t-1\right)\gamma_m + (\mu_{C_m}^t - w_m^t)\delta_m + \xi_m^t
\end{align*}
これより$M$駅$T$日分のデータは以下のように行列できる。
\begin{align*}
	G = {\bf Z}^{'}\beta + {\bf \mu} \gamma + {\bf \nu} \delta + \xi
\end{align*}
ただし、
\begin{align*}
	G = \begin{pmatrix} G_i\\
	\vdots\\
	G_M\end{pmatrix},\ {\bf Z} = \begin{pmatrix} \tilde{Z_1}&&&\\
	&\tilde{Z_2}&&\\
	&&\ddots&\\
	&&&\tilde{Z_M}
	\end{pmatrix}
\end{align*}
\end{document}





























